---
title: "Power Analysis"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# load libraries
library(ggplot2)
library(viridis)
library(tidyverse)
library(data.table)
library(raster)
library(igraph)
library(rgeos)
library(gridExtra)

# set number of simulations to run
n_sims <- 100000
```

## Question 1: How many hatchlings should be sampled from a nest to robustly estimate the number of males that contributed to it?

<!-- ### assuming random fertilization -->
<!-- ```{r, fig.height = 2.25, warning = FALSE} -->
<!-- source('eggs_to_sample.R') -->

<!-- eggs_to_sample(n_eggs = 100, max_hatchlings = 96, max_males = 7,  -->
<!--                breeding = 'random', n_sims = n_sims) -->
<!-- ``` -->
<!-- \newpage -->

<!-- ### assuming exponential decay in fertilization (1/2, 1/4, 1/8, etc.) -->
<!-- ```{r, fig.height = 4} -->
<!-- source('eggs_to_sample.R') -->

<!-- eggs_to_sample(n_eggs = 100,  -->
<!--                max_hatchlings = 96,  -->
<!--                max_males = 7,  -->
<!--                breeding = 'exponential',  -->
<!--                n_sims = n_sims) -->
<!-- ``` -->

<!-- \newpage -->

### Assuming one dominant sire that fertilizes 90% of eggs
```{r, fig.height = 2.75, warning = FALSE}
source('hatchlings_to_sample.R')

hatchlings_to_sample(n_hatchlings = 100, 
               max_hatchlings = 96, 
               max_males = 7, 
               breeding = 'dominant', 
               n_sims = n_sims, 
               dom = 0.9, 
               n_sizes = c(32, 40, 48, 56, 64, 72, 80, 88, 96))
```

\newpage

### Assuming one dominant sire that fertilizes 70% of eggs
```{r, fig.height = 4, warning = FALSE}
source('hatchlings_to_sample.R')

hatchlings_to_sample(n_hatchlings = 100, 
               max_hatchlings = 96, 
               max_males = 7, 
               breeding = 'dominant', 
               n_sims = n_sims, 
               dom = 0.7, 
               n_sizes = c(32, 40, 48, 56, 64, 72, 80, 88, 96))
```

\newpage

### Assuming one dominant sire that fertilizes 50% of eggs
```{r, fig.height = 4, warning = FALSE}
source('hatchlings_to_sample.R')

hatchlings_to_sample(n_hatchlings = 100, 
               max_hatchlings = 96, 
               max_males = 7, 
               breeding = 'dominant', 
               n_sims = n_sims, 
               dom = 0.5, 
               n_sizes = c(32, 40, 48, 56, 64, 72, 80, 88, 96))
```

\newpage

### Assuming one dominant sire where fertilization is flexible, and dependent on the total number of sires

#### Proportion fertilized by each sire is calculated as the average contribution for each sire based on Alfaro-Nunez et al. 2015:

```{r, echo = FALSE, warning = FALSE}
contribution <- data.frame(Sire1 = c(1, 0.8868, 0.4744, 0.5485, 0.4744), 
                           Sire2 = c(0, 0.1132, 0.3241, 0.2508, 0.1982), 
                           Sire3 = c(0, 0, 0.2015, 0.1509, 0.1523), 
                           Sire4 = c(0, 0, 0, 0.0499, 0.0997), 
                           Sire5 = c(0, 0, 0, 0, 0.0755))

row.names(contribution) <- c('1 Sire', 
                             '2 Sires', 
                             '3 Sires', 
                             '4 Sires', 
                             '5 Sires')
contribution
```

```{r, warning = FALSE}
source('hatchlings_to_sample.R')

hatchlings_to_sample(n_hatchlings = 100, 
               max_hatchlings = 96, 
               max_males = 5, 
               breeding = 'flexible_dominant', 
               n_sims = n_sims, 
               dom = NULL, 
               n_sizes = c(32, 40, 48, 56, 64, 72, 80, 88, 96))
```

<!-- \newpage -->

<!-- Question 2: How many females and nests should be sampled to get a robust estimate of the number of breeding males, and therefore the breeding sex ratio? -->

<!-- ### assuming random fertilization -->
<!-- ```{r, fig.height = 2.25, warning = FALSE} -->
<!-- source('sample_all_nests.R') -->

<!-- sample_all_nests(max_n_males = 7, -->
<!--                  max_n_females = 10,  -->
<!--                  minF = 10,  -->
<!--                  minM = 10,  -->
<!--                  maxF = 60,  -->
<!--                  maxM = 60,  -->
<!--                  breeding = 'random', -->
<!--                  nsims = n_sims) -->
<!-- ``` -->

<!-- \newpage -->

<!-- ### assuming exponential decay in fertilization (1 nest, 1/2, 1/4, 1/8, etc.) -->
<!-- ```{r, fig.height = 2.5, warning = FALSE} -->
<!-- source('sample_all_nests.R') -->

<!-- sample_all_nests(max_n_males = 7, -->
<!--                  max_n_females = 10,  -->
<!--                  minF = 10,  -->
<!--                  minM = 10,  -->
<!--                  maxF = 60,  -->
<!--                  maxM = 60,  -->
<!--                  breeding = 'exponential', -->
<!--                  nsims = n_sims) -->
<!-- ``` -->

<!-- \newpage -->

<!-- ### assuming one dominant sire -->
<!-- ```{r, fig.height = 2.5, warning = FALSE} -->
<!-- source('sample_all_nests.R') -->

<!-- sample_all_nests(max_n_males = 7, -->
<!--                  max_n_females = 10,  -->
<!--                  minF = 10,  -->
<!--                  minM = 10,  -->
<!--                  maxF = 60,  -->
<!--                  maxM = 60,  -->
<!--                  breeding = 'dominant', -->
<!--                  nsims = n_sims) -->
<!-- ``` -->
